<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MARPED â€“ TPN Hesaplama</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; margin: 0; padding-bottom: 100px; color: #333; }
    header { background: #6f42c1; color: white; padding: 15px; text-align: center; }
    .container { max-width: 500px; margin: auto; padding: 20px; }
    .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    label { display: block; margin: 12px 0 4px; font-weight: 500; font-size: 0.95rem; }
    input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
    .electrolyte-group { margin: 16px 0; padding: 12px; background: #f9f9f9; border-radius: 8px; border: 1px solid #eee; }
    .electrolyte-group h4 { margin: 0 0 10px; color: #6f42c1; font-size: 1rem; }
    button { width: 100%; padding: 12px; margin: 12px 0; background: #6f42c1; color: white; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; }
    button:hover { background: #5a32a3; }
    .result { margin-top: 20px; background: #f0f8ff; border: 1px solid #b3d4fc; border-radius: 8px; padding: 16px; display: none; }
    .result table { width: 100%; border-collapse: collapse; }
    .result td { padding: 8px 0; border-bottom: 1px solid #e0e0e0; }
    .result td:first-child { font-weight: bold; width: 58%; }
    .warning { color: #c0392b; font-size: 0.9rem; margin-top: 12px; }
    .note { font-size: 0.85rem; color: #555; margin-top: 20px; line-height: 1.4; }
    .ok { color: #146c43; font-weight: bold; margin: 6px 0; }
    .best { background: #e9f7ef; padding: 10px; border-radius: 8px; margin: 12px 0; }
    .bottom-menu { position: fixed; bottom: 0; left: 0; width: 100%; background: #6f42c1; display: flex; justify-content: space-around; padding: 8px 0; z-index: 1000; }
    .bottom-menu a { color: white; text-decoration: none; font-size: 13px; text-align: center; flex: 1; }
    .bottom-menu span { font-size: 11px; display: block; }
  </style>
</head>
<body>

<header>
  <h2>TPN Hesaplama</h2>
  <p>Pediatrik Total Parenteral Beslenme + GIR + Elektrolit</p>
</header>

<div class="container">
  <div class="card">

    <label>Hasta grubu (varsayÄ±lan deÄŸerler iÃ§in)</label>
    <select id="grup" onchange="otomatikDoldur()">
      <option value="">SeÃ§iniz</option>
      <option value="yenidogan">YenidoÄŸan / PrematÃ¼re</option>
      <option value="cocuk" selected>Ã‡ocuk (1 ay â€“ 10 yaÅŸ)</option>
      <option value="buyuk_cocuk">BÃ¼yÃ¼k Ã§ocuk / AdÃ¶lesan</option>
    </select>

    <label>Kilo (kg)</label>
    <input type="number" id="kg" step="0.01" min="0.4" placeholder="Ã–rn: 3.2" required>

    <label>Boy (cm) â€“ VYA iÃ§in (bÃ¶brek hastalarÄ±nda zorunlu)</label>
    <input type="number" id="boy" step="1" min="20" placeholder="Ã–rn: 50">

    <label>Toplam sÄ±vÄ± birimi</label>
    <select id="siviBirim" onchange="siviHedefGuncelle()">
      <option value="kg">mL/kg/gÃ¼n</option>
      <option value="m2">mL/mÂ²/gÃ¼n</option>
    </select>

    <label>Toplam sÄ±vÄ± hedefi</label>
    <select id="siviHedef">
      <!-- Dinamik doldurulacak -->
    </select>

    <label>Hedef enerji (kcal/kg/gÃ¼n)</label>
    <input type="number" id="enerji" step="1" value="80" min="40" max="120">

    <label>Protein hedefi (g/kg/gÃ¼n)</label>
    <input type="number" id="protein" step="0.1" value="2.5" min="1" max="4">

    <label>Lipid hedefi (g/kg/gÃ¼n)</label>
    <input type="number" id="lipidHedef" step="0.1" value="2" min="0" max="4">

    <label>Hedef GIR (mg/kg/dk)</label>
    <input type="number" id="hedefGir" step="0.1" value="8" min="4" max="14">

    <!-- Elektrolitler (Fosfat kaldÄ±rÄ±ldÄ±) -->
    <div class="electrolyte-group">
      <h4>Elektrolit / Vitamin (kg baÅŸÄ±na gÃ¼nlÃ¼k hedef)</h4>
      <label>Sodyum (Na) mmol/kg/gÃ¼n</label>
      <input type="number" id="na" step="0.1" value="2" min="0">

      <label>Potasyum (K) mmol/kg/gÃ¼n</label>
      <input type="number" id="k" step="0.1" value="2" min="0">

      <label>Kalsiyum (Ca) mmol/kg/gÃ¼n</label>
      <input type="number" id="ca" step="0.1" value="1" min="0">

      <label>Magnezyum (Mg) mmol/kg/gÃ¼n</label>
      <input type="number" id="mg" step="0.1" value="0.2" min="0">

      <label>Cernevit mL/gÃ¼n (toplam)</label>
      <input type="number" id="cernevit" step="0.1" value="1" min="0">

      <label>Tracutil mL/gÃ¼n (toplam)</label>
      <input type="number" id="tracutil" step="0.1" value="0.1" min="0">
    </div>

    <button onclick="hesaplaTPN()">Hesapla</button>

    <div class="result" id="sonuc"></div>
  </div>

  <div class="note">
    âš ï¸ %20 lipid, %10 aminoasit varsayÄ±ldÄ±. Elektrolit hacimleri yaklaÅŸÄ±k tahminidir.<br>
    VYA: Boy girilmediyse (kgÃ—4+7)/(90+kg), girilirse âˆš(kgÃ—boy)/60 kullanÄ±lÄ±r.<br>
    Nihai karar hekimindir.
  </div>
</div>

<div class="bottom-menu">
  <a href="index.html">ğŸ <br><span>Ana MenÃ¼</span></a>
  <a href="gir.html">ğŸ§®<br><span>Hesap</span></a>
  <a href="fizikmuayene.html">ğŸ“<br><span>Notlar</span></a>
</div>

<script>
// VÃ¼cut yÃ¼zey alanÄ± hesaplama
function vyaHesapla(kg, boy) {
  if (boy > 0) return Math.sqrt(kg * boy) / 60;
  return (kg * 4 + 7) / (90 + kg);
}

// Hasta grubuna gÃ¶re otomatik doldurma
function otomatikDoldur() {
  const grup = document.getElementById("grup").value;
  if (grup === "yenidogan") {
    document.getElementById("siviBirim").value = "kg";
    document.getElementById("enerji").value = 80;
    document.getElementById("protein").value = 3.0;
    document.getElementById("lipidHedef").value = 1.5;
    document.getElementById("hedefGir").value = 6;
    document.getElementById("na").value = 1;
    document.getElementById("k").value = 1;
    document.getElementById("ca").value = 0.8;
    document.getElementById("mg").value = 0.1;
  } else {
    document.getElementById("siviBirim").value = "kg";
    document.getElementById("enerji").value = 80;
    document.getElementById("protein").value = 2.5;
    document.getElementById("lipidHedef").value = 2;
    document.getElementById("hedefGir").value = 8;
    document.getElementById("na").value = 2;
    document.getElementById("k").value = 2;
    document.getElementById("ca").value = 1;
    document.getElementById("mg").value = 0.3;
  }
  siviHedefGuncelle();
}

// SÄ±vÄ± birimi deÄŸiÅŸince hedef seÃ§eneklerini gÃ¼ncelle (ayrÄ±lmÄ±ÅŸ)
function siviHedefGuncelle() {
  const birim = document.getElementById("siviBirim").value;
  const hedefSelect = document.getElementById("siviHedef");

  if (birim === "kg") {
    hedefSelect.innerHTML = `
      <option value="80">80 mL/kg</option>
      <option value="100">100 mL/kg</option>
      <option value="120" selected>120 mL/kg</option>
      <option value="140">140 mL/kg</option>
      <option value="160">160 mL/kg</option>
      <option value="180">180 mL/kg</option>
    `;
  } else {
    hedefSelect.innerHTML = `
      <option value="1000">1000 mL/mÂ²</option>
      <option value="1200" selected>1200 mL/mÂ²</option>
      <option value="1500">1500 mL/mÂ²</option>
      <option value="1700">1700 mL/mÂ²</option>
      <option value="2000">2000 mL/mÂ²</option>
    `;
  }
}

// Dekstroz karÄ±ÅŸÄ±m kombinasyonu
function kombinasyon(c1, c2, vol, hedef_g) {
  let g1 = c1 / 100, g2 = c2 / 100;
  let x = (hedef_g - g2 * vol) / (g1 - g2);
  if (x < 0 || x > vol || isNaN(x)) return null;
  return { d1: c1, ml1: x, d2: c2, ml2: vol - x, maxDex: Math.max(c1, c2) };
}

function hesaplaTPN() {
  const kg = parseFloat(document.getElementById("kg").value) || 0;
  if (kg <= 0) {
    document.getElementById("sonuc").innerHTML = "<p class='warning'>Kilo giriniz!</p>";
    document.getElementById("sonuc").style.display = "block";
    return;
  }

  const boy = parseFloat(document.getElementById("boy").value) || 0;
  const siviBirim = document.getElementById("siviBirim").value;
  const siviHedefDeger = parseFloat(document.getElementById("siviHedef").value) || 120;

  const vya = vyaHesapla(kg, boy);
  let toplamHacim = siviBirim === "m2" ? vya * siviHedefDeger : kg * siviHedefDeger;

  const enerji = parseFloat(document.getElementById("enerji").value) || 80;
  const proteinHedef = parseFloat(document.getElementById("protein").value) || 2.5;
  const lipidHedef = parseFloat(document.getElementById("lipidHedef").value) || 2;
  const hedefGir = parseFloat(document.getElementById("hedefGir").value) || 8;

  const na = parseFloat(document.getElementById("na").value) || 0;
  const k = parseFloat(document.getElementById("k").value) || 0;
  const ca = parseFloat(document.getElementById("ca").value) || 0;
  const mg = parseFloat(document.getElementById("mg").value) || 0;
  const cernevit = parseFloat(document.getElementById("cernevit").value) || 0;
  const tracutil = parseFloat(document.getElementById("tracutil").value) || 0;

  // TPN hesaplamalarÄ±
  const toplamEnerji = enerji * kg;
  const proteinG = proteinHedef * kg;
  const lipidG = lipidHedef * kg;
  const lipidKcal = lipidG * 9;
  const proteinKcal = proteinG * 4;
  const glukozKcal = toplamEnerji - proteinKcal - lipidKcal;
  const glukozG = glukozKcal / 3.4;
  const hesaplananGir = (glukozG * 1000) / (kg * 1440);

  const lipidHacim = lipidG * 5; // %20 lipid
  const aaHacim = proteinG * 10; // %10 AA

  // Elektrolit hacimleri yaklaÅŸÄ±k (fosfat kaldÄ±rÄ±ldÄ±)
  const naHacim = na * kg * 0.4;
  const kHacim = k * kg * 0.1;
  const caHacim = ca * kg * 0.47;
  const mgHacim = mg * kg * 0.04;

  const vitaminHacim = cernevit + tracutil;

  const toplamAyrilan = lipidHacim + aaHacim + naHacim + kHacim + caHacim + mgHacim + vitaminHacim;
  const dekstrozHacim = toplamHacim - toplamAyrilan;

  // Glukoz karÄ±ÅŸÄ±mÄ±
  const glukozHedef = hedefGir * kg * 1440 / 1000;
  const hedefYuzde = dekstrozHacim > 0 ? (glukozHedef / dekstrozHacim) * 100 : 0;

  let combos = [
    kombinasyon(10, 5, dekstrozHacim, glukozHedef),
    kombinasyon(20, 10, dekstrozHacim, glukozHedef),
    kombinasyon(30, 20, dekstrozHacim, glukozHedef)
  ].filter(x => x);

  let best = combos.length > 0 ? combos.reduce((a,b) => a.maxDex < b.maxDex ? a : b) : null;

  // SonuÃ§ HTML (fosfat satÄ±rÄ± kaldÄ±rÄ±ldÄ±)
  let html = `
    <table>
      <tr><td>VYA</td><td>${vya.toFixed(3)} mÂ²</td></tr>
      <tr><td>Toplam sÄ±vÄ±</td><td>${toplamHacim.toFixed(0)} mL/gÃ¼n (${siviBirim === "m2" ? siviHedefDeger + " mL/mÂ²" : siviHedefDeger + " mL/kg"})</td></tr>
      <tr><td>Lipid (%20 sol.)</td><td>${lipidHacim.toFixed(0)} mL</td></tr>
      <tr><td>Amino asit (%10)</td><td>${aaHacim.toFixed(0)} mL</td></tr>
      <tr><td>Elektrolit + vitamin hacmi (yaklaÅŸÄ±k)</td><td>${(toplamAyrilan - lipidHacim - aaHacim).toFixed(0)} mL</td></tr>
      <tr><td>Dekstroz iÃ§in kalan hacim</td><td><b>${dekstrozHacim.toFixed(0)} mL</b></td></tr>
      <tr><td>Glukoz (enerji bazlÄ±)</td><td>${glukozG.toFixed(1)} g</td></tr>
      <tr><td>Hesaplanan GIR</td><td><b>${hesaplananGir.toFixed(1)} mg/kg/dk</b></td></tr>
    </table>
  `;

  if (dekstrozHacim <= 0) {
    html += `<p class="warning">Dekstroz hacmi yetersiz veya negatif! Lipid + AA + elektrolitler toplam sÄ±vÄ±yÄ± aÅŸÄ±yor.</p>`;
  } else {
    html += `
      <h5>Dekstroz iÃ§in kalan ${dekstrozHacim.toFixed(0)} mL'de karÄ±ÅŸÄ±m (hedef GIR: ${hedefGir})</h5>
      <p>Gerekli glukoz: ${glukozHedef.toFixed(1)} g â†’ Ortalama %${hedefYuzde.toFixed(1)}</p>
    `;

    if (combos.length === 0) {
      html += `<p class="warning">âš ï¸ Bu GIR bu hacimde D5-D10-D20-D30 ile saÄŸlanamaz.</p>`;
    } else {
      combos.forEach(c => {
        html += `<div class="ok">${c.ml1.toFixed(0)} mL D${c.d1} + ${c.ml2.toFixed(0)} mL D${c.d2}</div>`;
      });
      if (best) {
        html += `<div class="best">ğŸ† Periferik dostu: ${best.ml1.toFixed(0)} mL D${best.d1} + ${best.ml2.toFixed(0)} mL D${best.d2} (max %${best.maxDex})</div>`;
      }
    }
  }

  document.getElementById("sonuc").innerHTML = html;
  document.getElementById("sonuc").style.display = "block";
}
</script>

</body>
</html>
