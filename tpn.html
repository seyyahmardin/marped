<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MARPED â€“ TPN Hesaplama</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding-bottom: 100px;
      color: #333;
    }
    header {
      background: #6f42c1;
      color: white;
      padding: 16px;
      text-align: center;
    }
    .container {
      padding: 16px;
      max-width: 480px;
      margin: 0 auto;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }
    label {
      display: block;
      margin: 12px 0 4px;
      font-weight: 500;
      font-size: 0.95rem;
    }
    select, input[type="number"], input[type="text"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 12px;
      margin: 12px 0 8px;
      background: #6f42c1;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.05rem;
      cursor: pointer;
    }
    button:hover { background: #5a32a3; }
    .result {
      margin-top: 20px;
      background: #f0f8ff;
      border: 1px solid #b3d4fc;
      border-radius: 8px;
      padding: 16px;
      display: none;
    }
    .result table {
      width: 100%;
      border-collapse: collapse;
    }
    .result td {
      padding: 8px 0;
      border-bottom: 1px solid #e0e0e0;
    }
    .result td:first-child {
      font-weight: 600;
      width: 58%;
    }
    .warning { color: #c0392b; font-size: 0.9rem; margin-top: 12px; }
    .note { font-size: 0.85rem; color: #555; margin-top: 20px; line-height: 1.4; }
    .ok { color: #146c43; font-weight: bold; }
    .best { background: #e9f7ef; padding: 10px; border-radius: 8px; margin: 12px 0; }
    .bottom-menu {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #6f42c1;
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
      z-index: 1000;
    }
    .bottom-menu a {
      color: white;
      text-decoration: none;
      font-size: 13px;
      text-align: center;
      flex: 1;
    }
    .bottom-menu span {
      font-size: 11px;
      display: block;
    }
  </style>
</head>
<body>

<header>
  <h2>TPN Hesaplama</h2>
  <p>Pediatrik Total Parenteral Beslenme + GIR â†’ Glukoz KarÄ±ÅŸÄ±mÄ±</p>
</header>

<div class="container">
  <div class="card">

    <label>Hasta grubu</label>
    <select id="grup" onchange="otomatikDoldur()">
      <option value="">SeÃ§iniz</option>
      <option value="yenidogan">YenidoÄŸan / PrematÃ¼re</option>
      <option value="cocuk">Ã‡ocuk (1 ay â€“ 10 yaÅŸ)</option>
      <option value="buyuk_cocuk">BÃ¼yÃ¼k Ã§ocuk / AdÃ¶lesan</option>
    </select>

    <label>Kilo (kg)</label>
    <input type="number" id="kg" step="0.01" min="0.4" placeholder="Ã–rn: 1.25">

    <label>Toplam sÄ±vÄ± hedefi (mL/kg/gÃ¼n)</label>
    <input type="number" id="sivi" step="1" value="100" min="60" max="160">

    <label>Hedef enerji (kcal/kg/gÃ¼n)</label>
    <input type="number" id="enerji" step="1" value="80" min="40" max="120">

    <label>Protein hedefi (g/kg/gÃ¼n)</label>
    <input type="number" id="protein" step="0.1" value="2.5" min="1.0" max="4.0">

    <label>Lipid oranÄ± (non-protein kalorinin %)</label>
    <input type="number" id="lipid_yuzde" step="5" value="35" min="20" max="50">

    <label>Hedef GIR (mg/kg/dk) â€“ Glukoz iÃ§in</label>
    <input type="number" id="hedef_gir" step="0.1" value="8" min="4" max="14">

    <button onclick="hesaplaTPN()">Hesapla</button>

    <div class="result" id="sonuc"></div>

  </div>

  <div class="note">
    âš ï¸ Lipid %20, Aminoasit %10 solÃ¼syon varsayÄ±ldÄ±.<br>
    GIR ve glukoz karÄ±ÅŸÄ±mÄ± hesaplarÄ± kalan sÄ±vÄ±ya gÃ¶re otomatik yapÄ±lÄ±r.<br>
    Periferik ven iÃ§in max %12-13 dekstroz Ã¶nerilir.<br>
    Klinik durum ve laboratuvara gÃ¶re ayarlayÄ±nÄ±z.
  </div>
</div>

<script>
function otomatikDoldur() {
  const grup = document.getElementById("grup").value;
  if (grup === "yenidogan") {
    document.getElementById("sivi").value = 90;
    document.getElementById("enerji").value = 80;
    document.getElementById("protein").value = 3.0;
    document.getElementById("lipid_yuzde").value = 30;
    document.getElementById("hedef_gir").value = 6; // yenidoÄŸan baÅŸlangÄ±Ã§ dÃ¼ÅŸÃ¼k
  } else {
    document.getElementById("sivi").value = 100;
    document.getElementById("enerji").value = 80;
    document.getElementById("protein").value = 2.5;
    document.getElementById("lipid_yuzde").value = 35;
    document.getElementById("hedef_gir").value = 8;
  }
}

function kombinasyon(c1, c2, vol, hedef_glukoz) {
  let g1 = c1 / 100, g2 = c2 / 100;
  let x = (hedef_glukoz - g2 * vol) / (g1 - g2);
  if (x < 0 || x > vol) return null;
  return {
    d1: c1, ml1: x,
    d2: c2, ml2: vol - x,
    maxDex: Math.max(c1, c2)
  };
}

function hesaplaTPN() {
  const grup   = document.getElementById("grup").value;
  const kg     = parseFloat(document.getElementById("kg").value)     || 0;
  const sivi   = parseFloat(document.getElementById("sivi").value)   || 100;
  const enerji = parseFloat(document.getElementById("enerji").value) || 80;
  const prot   = parseFloat(document.getElementById("protein").value)|| 2.5;
  const lipidY = parseFloat(document.getElementById("lipid_yuzde").value) || 35;
  const hedefGIR = parseFloat(document.getElementById("hedef_gir").value) || 8;

  if (!grup || kg <= 0) {
    alert("Hasta grubunu seÃ§in ve geÃ§erli kilo girin.");
    return;
  }

  // TPN temel hesaplamalar
  const toplamEnerji   = enerji * kg;
  const proteinG       = prot   * kg;
  const proteinKcal    = proteinG * 4;
  const nonProteinKcal = toplamEnerji - proteinKcal;
  const lipidKcal      = nonProteinKcal * (lipidY / 100);
  const lipidG         = lipidKcal / 9;
  const glukozG        = (nonProteinKcal - lipidKcal) / 3.4;
  const toplamHacim    = sivi * kg;

  const gir            = (glukozG * 1000) / (kg * 1440);
  const lipidHacim20   = lipidG * 5;
  const kalanHacim     = toplamHacim - lipidHacim20;
  const aaHacim10      = proteinG * 10;

  // GIR â†’ Glukoz karÄ±ÅŸÄ±mÄ± hesabÄ± (kalan hacim iÃ§in)
  let glukozHedef = hedefGIR * kg * 1440 / 1000; // gÃ¼nlÃ¼k glukoz gram
  let hedefYuzde  = kalanHacim > 0 ? (glukozHedef / kalanHacim) * 100 : 0;

  let combos = [
    kombinasyon(10, 5, kalanHacim, glukozHedef),
    kombinasyon(20, 10, kalanHacim, glukozHedef),
    kombinasyon(30, 20, kalanHacim, glukozHedef)
  ].filter(x => x);

  let bestCombo = null;
  if (combos.length > 0) {
    bestCombo = combos.reduce((a, b) => a.maxDex < b.maxDex ? a : b);
  }

  // UyarÄ±lar
  let uyari = "";
  if (gir > 12) uyari += "â†’ GIR >12 mg/kg/dk (dikkatli artÄ±rÄ±n)<br>";
  if (hedefYuzde > 12.5 && kalanHacim > 0) uyari += "â†’ Kalan sÄ±vÄ±da % dekstroz >12.5 olabilir (periferik ven iÃ§in riskli)<br>";

  // SonuÃ§ HTML
  let html = `
    <table>
      <tr><td>Toplam enerji</td><td>${toplamEnerji.toFixed(0)} kcal/gÃ¼n</td></tr>
      <tr><td>Protein</td><td>${proteinG.toFixed(1)} g/gÃ¼n  (${prot.toFixed(1)} g/kg)</td></tr>
      <tr><td>%10 Aminoasit hacmi</td><td>${aaHacim10.toFixed(0)} mL</td></tr>
      <tr><td>Lipid</td><td>${lipidG.toFixed(1)} g/gÃ¼n</td></tr>
      <tr><td>%20 Lipid solÃ¼syon</td><td>${lipidHacim20.toFixed(0)} mL</td></tr>
      <tr><td>Glukoz / Karbonhidrat</td><td>${glukozG.toFixed(1)} g/gÃ¼n</td></tr>
      <tr><td>GIR (hesaplanan)</td><td><b>${gir.toFixed(1)}</b> mg/kg/dk</td></tr>
      <tr><td>Toplam sÄ±vÄ±</td><td>${toplamHacim.toFixed(0)} mL/gÃ¼n</td></tr>
      <tr><td>Kalan hacim (AA + dekstroz)</td><td>${kalanHacim.toFixed(0)} mL</td></tr>
      <tr><td>Hedef GIR (girdiÄŸiniz)</td><td>${hedefGIR.toFixed(1)} mg/kg/dk</td></tr>
    </table>
  `;

  // Glukoz karÄ±ÅŸÄ±mÄ± bÃ¶lÃ¼mÃ¼
  if (kalanHacim > 0) {
    html += `
      <h5 style="margin-top:16px;">Kalan SÄ±vÄ± (${kalanHacim.toFixed(0)} mL) iÃ§in Glukoz KarÄ±ÅŸÄ±mÄ±</h5>
      <p><b>GÃ¼nlÃ¼k glukoz ihtiyacÄ± (hedef GIR'e gÃ¶re):</b> ${glukozHedef.toFixed(1)} g</p>
      <p><b>Ortalama hedef konsantrasyon:</b> %${hedefYuzde.toFixed(1)}</p>
    `;

    if (combos.length === 0) {
      html += `<p class="warning">âš ï¸ Bu GIR bu hacimde D5-D10-D20-D30 ile saÄŸlanamaz.</p>`;
    } else {
      combos.forEach(c => {
        html += `<div class="ok">
          ${c.ml1.toFixed(0)} mL D${c.d1} + ${c.ml2.toFixed(0)} mL D${c.d2}
        </div>`;
      });

      if (bestCombo) {
        html += `
          <div class="best">
            ğŸ† <b>Periferik dostu en iyi Ã¶neri:</b><br>
            ${bestCombo.ml1.toFixed(0)} mL D${bestCombo.d1} + ${bestCombo.ml2.toFixed(0)} mL D${bestCombo.d2}
            (max %${bestCombo.maxDex})
          </div>
        `;
      }
    }
  } else {
    html += `<p class="warning">Lipid hacmi toplam sÄ±vÄ±yÄ± aÅŸtÄ± â†’ glukoz karÄ±ÅŸÄ±mÄ± hesaplanamadÄ±.</p>`;
  }

  if (uyari) html += `<div class="warning">${uyari}</div>`;

  document.getElementById("sonuc").innerHTML = html;
  document.getElementById("sonuc").style.display = "block";
}
</script>

<div class="bottom-menu">
  <a href="index.html">ğŸ <br><span>Ana MenÃ¼</span></a>
  <a href="gir.html">ğŸ§®<br><span>Hesap</span></a>
  <a href="fizikmuayene.html">ğŸ“<br><span>Notlar</span></a>
</div>

</body>
</html>
