<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MARPED ‚Äì TPN Hesaplama</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding-bottom: 100px;
      color: #333;
    }
    header {
      background: #6f42c1;
      color: white;
      padding: 16px;
      text-align: center;
    }
    .container {
      padding: 16px;
      max-width: 480px;
      margin: 0 auto;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }
    label {
      display: block;
      margin: 10px 0 4px;
      font-weight: 500;
      font-size: 0.95rem;
    }
    select, input[type="number"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    .electrolyte-group {
      margin: 16px 0;
      padding: 12px;
      background: #f9f9f9;
      border-radius: 8px;
      border: 1px solid #eee;
    }
    .electrolyte-group h4 {
      margin: 0 0 10px;
      font-size: 1rem;
      color: #6f42c1;
    }
    button {
      width: 100%;
      padding: 12px;
      margin: 12px 0;
      background: #6f42c1;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.05rem;
      cursor: pointer;
    }
    button:hover { background: #5a32a3; }
    .result {
      margin-top: 20px;
      background: #f0f8ff;
      border: 1px solid #b3d4fc;
      border-radius: 8px;
      padding: 16px;
      display: none;
    }
    .result table {
      width: 100%;
      border-collapse: collapse;
    }
    .result td {
      padding: 8px 0;
      border-bottom: 1px solid #e0e0e0;
    }
    .result td:first-child {
      font-weight: 600;
      width: 58%;
    }
    .warning { color: #c0392b; font-size: 0.9rem; margin-top: 12px; }
    .note { font-size: 0.85rem; color: #555; margin-top: 20px; line-height: 1.4; }
    .ok { color: #146c43; font-weight: bold; }
    .best { background: #e9f7ef; padding: 10px; border-radius: 8px; margin: 12px 0; }
    .bottom-menu {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #6f42c1;
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
      z-index: 1000;
    }
    .bottom-menu a {
      color: white;
      text-decoration: none;
      font-size: 13px;
      text-align: center;
      flex: 1;
    }
    .bottom-menu span {
      font-size: 11px;
      display: block;
    }
  </style>
</head>
<body>

<header>
  <h2>TPN Hesaplama</h2>
  <p>Pediatrik Total Parenteral Beslenme + Elektrolit / Vitamin</p>
</header>

<div class="container">
  <div class="card">

    <label>Hasta grubu</label>
    <select id="grup" onchange="otomatikDoldur()">
      <option value="">Se√ßiniz</option>
      <option value="yenidogan">Yenidoƒüan / Premat√ºre</option>
      <option value="cocuk">√áocuk (1 ay ‚Äì 10 ya≈ü)</option>
      <option value="buyuk_cocuk">B√ºy√ºk √ßocuk / Ad√∂lesan</option>
    </select>

    <label>Kilo (kg)</label>
    <input type="number" id="kg" step="0.01" min="0.4" placeholder="√ñrn: 1.25">

    <label>Boy (cm) ‚Äì VYA hesabƒ± i√ßin opsiyonel</label>
    <input type="number" id="boy" step="1" min="30" placeholder="√ñrn: 50 (b√∂brek hastalarƒ±nda zorunlu)">

    <label>Sƒ±vƒ± hedefi birimi</label>
    <select id="sivi_birim">
      <option value="kg">mL/kg/g√ºn</option>
      <option value="m2">mL/m¬≤/g√ºn</option>
    </select>

    <label>Sƒ±vƒ± hedefi deƒüeri</label>
    <select id="sivi_deger">
      <option value="100">100 mL/kg (veya 1200 mL/m¬≤)</option>
      <option value="120">120 mL/kg (veya 1500 mL/m¬≤)</option>
      <option value="140">140 mL/kg (veya 1700 mL/m¬≤)</option>
      <option value="160">160 mL/kg (veya 2000 mL/m¬≤)</option>
    </select>

    <label>Hedef enerji (kcal/kg/g√ºn)</label>
    <input type="number" id="enerji" step="1" value="80" min="40" max="120">

    <label>Protein hedefi (g/kg/g√ºn)</label>
    <input type="number" id="protein" step="0.1" value="2.5" min="1.0" max="4.0">

    <label>Lipid hedefi (g/kg/g√ºn)</label>
    <input type="number" id="lipid_hed" step="0.1" value="2" min="0" max="4">

    <label>Hedef GIR (mg/kg/dk)</label>
    <input type="number" id="hedef_gir" step="0.1" value="8" min="4" max="14">

    <!-- Elektrolit / Vitamin -->
    <div class="electrolyte-group">
      <h4>Elektrolit / Mineral / Vitamin (kg ba≈üƒ±na g√ºnl√ºk hedef)</h4>
      
      <label>Sodyum (Na) mmol/kg/g√ºn</label>
      <input type="number" id="na" step="0.1" value="2" min="0">

      <label>Potasyum Klor√ºr (K) mmol/kg/g√ºn</label>
      <input type="number" id="k" step="0.1" value="2" min="0">

      <label>Potasyum Fosfat (P katkƒ±sƒ±) mmol/kg/g√ºn</label>
      <input type="number" id="p" step="0.1" value="0.5" min="0">

      <label>Kalsiyum glukonat (Ca) mmol/kg/g√ºn</label>
      <input type="number" id="ca" step="0.1" value="1" min="0">

      <label>Magnezyum s√ºlfat (Mg) mmol/kg/g√ºn</label>
      <input type="number" id="mg" step="0.1" value="0.2" min="0">

      <label>Cernevit (multivitamin) mL/g√ºn</label>
      <input type="number" id="cernevit" step="0.1" value="1" min="0">

      <label>Tracutil (trace element) mL/g√ºn</label>
      <input type="number" id="tracutil" step="0.1" value="0.1" min="0">
    </div>

    <button onclick="hesaplaTPN()">Hesapla</button>

    <div class="result" id="sonuc"></div>

  </div>

  <div class="note">
    ‚ö†Ô∏è Lipid %20, Aminoasit %10 sol√ºsyon varsayƒ±ldƒ±.<br>
    VYA hesabƒ±: Boy girilmediyse (kg√ó4+7)/(90+kg) form√ºl√º kullanƒ±lƒ±r.<br>
    B√∂brek hastalarƒ±nda boy girerek ‚àö(kg√óboy)/60 form√ºl√ºn√º se√ßin.<br>
    Elektrolit deƒüerleri kg ba≈üƒ±na g√ºnl√ºk hedef olarak girilmelidir.<br>
    Bo≈ü bƒ±rakƒ±lanlar 0 kabul edilir.
  </div>
</div>

<script>
function vyaHesapla(kg, boy) {
  if (boy && boy > 0) {
    return Math.sqrt(kg * boy) / 60; // ‚àö(kg √ó boy / 3600) = sqrt(kg*boy)/60
  } else {
    return (kg * 4 + 7) / (90 + kg);
  }
}

function otomatikDoldur() {
  const grup = document.getElementById("grup").value;
  if (grup === "yenidogan") {
    document.getElementById("sivi_birim").value = "kg";
    document.getElementById("sivi_deger").value = "90";
    document.getElementById("enerji").value = 80;
    document.getElementById("protein").value = 3.0;
    document.getElementById("lipid_hed").value = 2.0;
    document.getElementById("hedef_gir").value = 6;
    document.getElementById("na").value = 1;
    document.getElementById("k").value = 1;
    document.getElementById("p").value = 0.5;
    document.getElementById("ca").value = 0.8;
    document.getElementById("mg").value = 0.1;
    document.getElementById("cernevit").value = 1;
    document.getElementById("tracutil").value = 0.1;
  } else {
    document.getElementById("sivi_birim").value = "kg";
    document.getElementById("sivi_deger").value = "100";
    document.getElementById("enerji").value = 80;
    document.getElementById("protein").value = 2.5;
    document.getElementById("lipid_hed").value = 2.0;
    document.getElementById("hedef_gir").value = 8;
    document.getElementById("na").value = 2;
    document.getElementById("k").value = 2;
    document.getElementById("p").value = 0.7;
    document.getElementById("ca").value = 1.0;
    document.getElementById("mg").value = 0.3;
    document.getElementById("cernevit").value = 1;
    document.getElementById("tracutil").value = 0.1;
  }
}

function kombinasyon(c1, c2, vol, hedef_glukoz) {
  let g1 = c1 / 100, g2 = c2 / 100;
  let x = (hedef_glukoz - g2 * vol) / (g1 - g2);
  if (x < 0 || x > vol) return null;
  return { d1: c1, ml1: x, d2: c2, ml2: vol - x, maxDex: Math.max(c1, c2) };
}

function hesaplaTPN() {
  const kg = parseFloat(document.getElementById("kg").value) || 0;
  if (kg <= 0) {
    alert("Ge√ßerli kilo giriniz.");
    return;
  }

  const boy = parseFloat(document.getElementById("boy").value) || 0;
  const siviBirim = document.getElementById("sivi_birim").value;
  const siviDeger = parseFloat(document.getElementById("sivi_deger").value) || 100;

  const vya = vyaHesapla(kg, boy);
  let toplamHacim;
  if (siviBirim === "m2") {
    toplamHacim = vya * siviDeger;
  } else {
    toplamHacim = kg * siviDeger;
  }

  const enerji = parseFloat(document.getElementById("enerji").value) || 80;
  const prot = parseFloat(document.getElementById("protein").value) || 2.5;
  const lipidHedef = parseFloat(document.getElementById("lipid_hed").value) || 2;
  const hedefGIR = parseFloat(document.getElementById("hedef_gir").value) || 8;

  const na = parseFloat(document.getElementById("na").value) || 0;
  const k = parseFloat(document.getElementById("k").value) || 0;
  const p = parseFloat(document.getElementById("p").value) || 0;
  const ca = parseFloat(document.getElementById("ca").value) || 0;
  const mg = parseFloat(document.getElementById("mg").value) || 0;
  const cernevit = parseFloat(document.getElementById("cernevit").value) || 0;
  const tracutil = parseFloat(document.getElementById("tracutil").value) || 0;

  // TPN hesaplamalar
  const toplamEnerji = enerji * kg;
  const proteinG = prot * kg;
  const proteinKcal = proteinG * 4;
  const lipidG = lipidHedef * kg;
  const lipidKcal = lipidG * 9;
  const nonProteinKcal = toplamEnerji - proteinKcal;
  const glukozKcal = nonProteinKcal - lipidKcal;
  const glukozG = glukozKcal / 3.4;
  const gir = (glukozG * 1000) / (kg * 1440);

  const lipidHacim20 = lipidG * 5;
  const kalanHacim = toplamHacim - lipidHacim20;
  const aaHacim10 = proteinG * 10;

  // Glukoz karƒ±≈üƒ±mƒ±
  let glukozHedef = hedefGIR * kg * 1440 / 1000;
  let hedefYuzde = kalanHacim > 0 ? (glukozHedef / kalanHacim) * 100 : 0;

  let combos = [
    kombinasyon(10, 5, kalanHacim, glukozHedef),
    kombinasyon(20, 10, kalanHacim, glukozHedef),
    kombinasyon(30, 20, kalanHacim, glukozHedef)
  ].filter(x => x);

  let bestCombo = combos.length > 0 ? combos.reduce((a,b)=>a.maxDex < b.maxDex ? a : b) : null;

  // Uyarƒ±lar
  let uyari = "";
  if (gir > 12) uyari += "‚Üí GIR >12 mg/kg/dk (dikkatli artƒ±rƒ±n)<br>";
  if (hedefYuzde > 12.5 && kalanHacim > 0) uyari += "‚Üí Kalan sƒ±vƒ±da % dekstroz >12.5 olabilir (periferik ven i√ßin riskli)<br>";

  // Sonu√ß HTML
  let html = `
    <table>
      <tr><td>V√ºcut Y√ºzey Alanƒ± (VYA)</td><td>${vya.toFixed(3)} m¬≤</td></tr>
      <tr><td>Toplam enerji</td><td>${toplamEnerji.toFixed(0)} kcal/g√ºn</td></tr>
      <tr><td>Protein</td><td>${proteinG.toFixed(1)} g (${prot.toFixed(1)} g/kg)</td></tr>
      <tr><td>%10 AA hacmi</td><td>${aaHacim10.toFixed(0)} mL</td></tr>
      <tr><td>Lipid</td><td>${lipidG.toFixed(1)} g (${lipidHedef.toFixed(1)} g/kg)</td></tr>
      <tr><td>%20 Lipid</td><td>${lipidHacim20.toFixed(0)} mL</td></tr>
      <tr><td>Glukoz</td><td>${glukozG.toFixed(1)} g</td></tr>
      <tr><td>GIR (hesaplanan)</td><td><b>${gir.toFixed(1)} mg/kg/dk</b></td></tr>
      <tr><td>Toplam sƒ±vƒ±</td><td>${toplamHacim.toFixed(0)} mL/g√ºn (${siviBirim === 'm2' ? (siviDeger + ' mL/m¬≤' : siviDeger + ' mL/kg')})</td></tr>
      <tr><td>Kalan hacim (AA+glukoz)</td><td>${kalanHacim.toFixed(0)} mL</td></tr>
    </table>
  `;

  // Elektrolit tablosu
  html += `<h5>Elektrolit / Mineral / Vitamin (toplam g√ºnl√ºk)</h5><table>`;
  if (na > 0) html += `<tr><td>Sodyum (Na)</td><td>${(na * kg).toFixed(1)} mmol/g√ºn</td></tr>`;
  if (k > 0) html += `<tr><td>Potasyum (KCl)</td><td>${(k * kg).toFixed(1)} mmol/g√ºn</td></tr>`;
  if (p > 0) html += `<tr><td>Fosfat (Potasyum fosfat)</td><td>${(p * kg).toFixed(2)} mmol/g√ºn</td></tr>`;
  if (ca > 0) html += `<tr><td>Kalsiyum (glukonat)</td><td>${(ca * kg).toFixed(2)} mmol/g√ºn</td></tr>`;
  if (mg > 0) html += `<tr><td>Magnezyum (s√ºlfat)</td><td>${(mg * kg).toFixed(2)} mmol/g√ºn</td></tr>`;
  if (cernevit > 0) html += `<tr><td>Cernevit</td><td>${cernevit.toFixed(1)} mL/g√ºn</td></tr>`;
  if (tracutil > 0) html += `<tr><td>Tracutil</td><td>${tracutil.toFixed(1)} mL/g√ºn</td></tr>`;
  html += `</table>`;

  // Glukoz karƒ±≈üƒ±mƒ±
  if (kalanHacim > 0) {
    html += `
      <h5>Kalan Sƒ±vƒ± (${kalanHacim.toFixed(0)} mL) i√ßin Glukoz Karƒ±≈üƒ±mƒ± (hedef GIR: ${hedefGIR})</h5>
      <p>G√ºnl√ºk glukoz ihtiyacƒ±: ${glukozHedef.toFixed(1)} g ‚Üí Ortalama %${hedefYuzde.toFixed(1)}</p>
    `;
    if (combos.length === 0) {
      html += `<p class="warning">‚ö†Ô∏è Bu GIR bu hacimde D5-D10-D20-D30 ile saƒülanamaz.</p>`;
    } else {
      combos.forEach(c => {
        html += `<div class="ok">${c.ml1.toFixed(0)} mL D${c.d1} + ${c.ml2.toFixed(0)} mL D${c.d2}</div>`;
      });
      if (bestCombo) {
        html += `<div class="best">üèÜ En iyi (periferik): ${bestCombo.ml1.toFixed(0)} mL D${bestCombo.d1} + ${bestCombo.ml2.toFixed(0)} mL D${bestCombo.d2} (max %${bestCombo.maxDex})</div>`;
      }
    }
  }

  if (uyari) html += `<div class="warning">${uyari}</div>`;

  document.getElementById("sonuc").innerHTML = html;
  document.getElementById("sonuc").style.display = "block";
}

function kombinasyon(c1, c2, vol, hedef_glukoz) {
  let g1 = c1 / 100, g2 = c2 / 100;
  let x = (hedef_glukoz - g2 * vol) / (g1 - g2);
  if (x < 0 || x > vol) return null;
  return { d1: c1, ml1: x, d2: c2, ml2: vol - x, maxDex: Math.max(c1, c2) };
}
</script>

<div class="bottom-menu">
  <a href="index.html">üè†<br><span>Ana Men√º</span></a>
  <a href="gir.html">üßÆ<br><span>Hesap</span></a>
  <a href="fizikmuayene.html">üìù<br><span>Notlar</span></a>
</div>

</body>
</html>
